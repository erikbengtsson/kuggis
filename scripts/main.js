"use strict";function getGames(){gamesRef.on("value",function(e){$("#game-list").html(""),e.val()||$("#game-list").html("<li>No open games</li>"),e.forEach(function(e){e.val().players?gameTemplate(e):gamesRef.child(e.key).remove()})})}function createGame(e,a){""===a&&(a=!1),gamesRef.push({title:e,password:a,players:"temp"}).then(function(e){console.log(e.key);var a=$("#username").val();joinGame(e.key,a)})}function joinGame(e,a){gamesRef.child(e+"/players").push({username:a}).then(function(a){sessionStorage.gameUserId=a.key,sessionStorage.gameId=e,setMyCurrentGame(e)})}function setMyCurrentGame(e){$(".window").hide();var a=$(".game");a.show(),gamesRef.child(e).on("value",function(e){$("#gameName").html(e.val().title),$("#playerList").html(""),e.child("players").forEach(function(e){playerTemplate(e)})})}function leaveCurrentGame(){$(".window").hide(),$(".lobby").show();var e=sessionStorage.gameId,a=sessionStorage.gameUserId;gamesRef.child(e+"/players/"+a).remove(),sessionStorage.gameId="",sessionStorage.gameUserId=""}function showNewGameWindow(){$(".window").hide(),$(".new").show()}function playerTemplate(e){var a=$("<li>"+e.val().username+"</li>");$("#playerList").append(a)}function gameTemplate(e){var a=$("<li>"+e.val().title+' <button class="joinGame" data-id="'+e.key+'">Join</button></li>');$("#game-list").append(a)}var config={apiKey:"AIzaSyBOJC2_Dj_BvqKkVBUZnV9jay-euuIrrhI",authDomain:"kuggis-99246.firebaseapp.com",databaseURL:"https://kuggis-99246.firebaseio.com",storageBucket:"kuggis-99246.appspot.com",messagingSenderId:"625398520132"};firebase.initializeApp(config);var gamesRef=firebase.database().ref("/games");window.onbeforeunload=function(e){if(sessionStorage.gameId)return disconnect(),!0},function(){getGames(),sessionStorage.gameId&&""!=sessionStorage.gameId&&(console.log(sessionStorage.gameId),setMyCurrentGame(sessionStorage.gameId)),$("#newGame").on("click",function(){showNewGameWindow()}),$("#newGameButton").on("click",function(){var e=$("#newGameTitle").val();if($("#newGamePassword").val())var a=$("#newGamePassword").val();else var a=!1;createGame(e,a)}),$("#game-list").on("click","button",function(){var e=$(this).attr("data-id"),a=$("#username").val();joinGame(e,a)}),$(".leaveGame").on("click",function(){sessionStorage.gameId?confirm("Vill du verkligen l√§mna spelet?")&&leaveCurrentGame():leaveCurrentGame()})}();